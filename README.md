個人用のブックマークリストを作るChrome 拡張

### UI

- 拡張アイコンをクリックすると「Bookmark success」というポップアップを表示する（重複時は「既にブックマークされています」と表示）
- ブックマークリストはブックマークした記事のタイトルをリンクで表示
- ブックマークリストを表示する前にパスワード認証が必要（初回起動時にパスワードを設定、または「パスワードを利用しない」を選択可能）
- 最上部に「検索フォーム」を用意して検索できるように
- 最大で100件表示。以降はページ送り
- ダウンロードボタンを用意してクリックするとCSVファイルでダウンロードできるようにする
- クリアボタンで全ブックマークを削除できる

## インストール方法

1. アイコンファイルを生成する（以下のいずれかの方法）

   **方法1: HTMLツールを使用（推奨）**
   - `generate-icons.html`をブラウザで開く
   - 各サイズのアイコンの下にある「ダウンロード」ボタンをクリック
   - ダウンロードしたファイルを`icons`フォルダに保存

   **方法2: Pythonスクリプトを使用**
   ```bash
   pip install Pillow
   python generate-icons.py
   ```

2. Chrome拡張機能を読み込む
   - Chromeで`chrome://extensions/`を開く
   - 「デベロッパーモード」を有効にする
   - 「パッケージ化されていない拡張機能を読み込む」をクリック
   - このプロジェクトのフォルダを選択

## 使用方法

1. ブックマークを追加: 拡張機能のアイコンをクリックすると、現在のページがブックマークに追加されます
2. ブックマークリストを表示: 以下のいずれかの方法でブックマークリストを開けます
   - 拡張アイコンをクリックした後、ポップアップ内でCtrlキー（MacではCommandキー）を押すと、ブックマークを追加せずに直接リストが開きます
   - ショートカットキー `Ctrl+Shift+B`（Macでは`Command+Shift+B`）を押す
   - 拡張アイコンを右クリックして「ブックマークリストを開く」を選択
3. パスワード認証: ブックマークリストを表示する前にパスワード入力画面が表示されます。初回起動時はパスワードを設定するか、「パスワードを利用しない」を選択できます。パスワードを設定した場合は、パスワードを入力して「ロック解除」ボタンをクリック（またはEnterキーを押す）してください。一度認証すると、ブラウザタブを閉じるまで再認証は不要です
4. パスワードの設定・変更: 拡張アイコンを右クリックして「パスワードを設定（変更）する」を選択すると、パスワードの設定や変更ができます。既にパスワードが設定されている場合は、現在のパスワードを入力してから新しいパスワードを設定します
5. パスワードを忘れた場合: パスワード入力画面の「パスワードを忘れた場合」リンクをクリックすると、すべてのデータ（ブックマーク、パスワード設定）を削除してリセットできます。この操作は取り消せません。CSVバックアップがある場合は、リセット後にインポートして復元できます
6. 検索: リストページ上部の検索フォームでタイトルやURLを検索できます
7. 保護機能: 各ブックマークの左側にある星マーク（☆）をクリックすると保護状態（★）になります。保護されたブックマークは常にリストの上部に表示され、容量が100KBを超えた場合の自動削除からも除外されます
8. 個別削除: 各ブックマーク項目の右側にある「×」ボタンをクリックすると、そのブックマークを個別に削除できます（確認ダイアログが表示されます）
9. CSVダウンロード: 「CSVダウンロード」ボタンでブックマークをCSV形式でダウンロードできます
10. CSVインポート: リストページ最下部の「CSVインポート」ボタンで、エクスポートしたCSVファイルをインポートしてブックマークを復元できます。既存のブックマークがある場合は追加されます（重複するURLはスキップされます）
11. クリア: 「クリア」ボタンで全ブックマークを削除できます（確認ダイアログが表示されます）
12. 自動削除: 容量が100KBを超えた場合、保護されていない古いブックマークから自動的に削除されます（保護されたブックマークは削除されません）

## 重要な注意事項

### データの保存について

- ブックマークデータは `chrome.storage.sync` に保存され、**同じGoogleアカウントでログインしているすべてのChromeブラウザで自動的に同期されます**
- 同期ストレージの容量制限は約100KBです。ブックマークリストの上部に現在の使用容量が表示されます
- 容量が80%を超えると警告色（赤）で表示されます
- 容量制限に達した場合、新しいブックマークを追加できなくなる可能性があります
- **拡張機能を削除（アンインストール）すると、すべてのブックマークデータが削除されます**
- データを保護するため、定期的にCSVダウンロード機能でバックアップを取得することを推奨します
- 拡張機能を再インストールする場合は、事前にCSVでバックアップを取得し、CSVインポート機能で復元してください

### 同期機能について

- ブックマークデータは自動的にGoogleアカウント間で同期されます
- **保護状態も含めて同期されます**。あるデバイスでブックマークを保護すると、他のデバイスでも同じ保護状態が反映されます
- 同期には数秒〜数分かかる場合があります
- オフライン時はローカルに保存され、オンライン復帰時に自動的に同期されます
- 複数のデバイスで同じGoogleアカウントを使用している場合、すべてのデバイスで同じブックマークデータ（保護状態を含む）にアクセスできます
- **PCや住所が異なる自宅と事務所でも、同じGoogleアカウントでログインしていればデータは自動的に共有されます**

### 重複データの処理について

#### 重複時の動作

1. **同じ記事を再度ブックマークした場合**
   - 「既にブックマークされています」というメッセージが表示されます
   - 既存のブックマークの日時が現在の日時に更新されます
   - 既存のブックマークがリストの先頭に移動します
   - 保護状態は維持されます

2. **CSVインポート時の重複処理**
   - 既存のブックマークとURLが重複する場合は、インポート時にスキップされます
   - 重複した件数がメッセージに表示されます

3. **同期時の自動重複チェック**
   - 他のデバイスから同期された際に、同じURLのデータが複数存在する場合、自動的に重複を削除します
   - 重複削除の優先順位：
     1. 日時が新しいものを優先
     2. 日時が同じ場合は、保護されているものを優先
     3. どちらも同じ場合は、既存のものを残す

#### データの同期と重複

- **CSVインポート後の同期**
  - CSVインポート後に他のデバイスから古いデータが同期された場合、重複が発生する可能性があります
  - この場合、自動的に重複チェックが実行され、最新のデータを残して古いデータを削除します
  - ブックマーク読み込み時にも自動的に重複をチェック・削除します

- **複数デバイス間での同期**
  - 自宅と事務所など、異なる場所のPCでも同じGoogleアカウントでログインしていれば、データは自動的に同期されます
  - 一方のデバイスで拡張機能を削除しても、もう一方のデバイスのデータには影響しません
  - ただし、削除したデバイスで再インストールしても、データは自動復元されません（CSVインポートが必要）

#### 重複データの自動整理

- ブックマーク読み込み時に自動的に重複をチェック
- ストレージ変更時（同期など）に自動的に重複をチェック
- 重複が見つかった場合、自動的に削除してストレージに保存

### パスワード機能について

#### パスワードの設定

- 初回起動時にパスワードを設定するか、「パスワードを利用しない」を選択できます
- パスワードはSHA-256でハッシュ化されて保存されます（平文では保存されません）
- パスワードは4文字以上で設定できます
- パスワードを設定しない場合でも、ブックマークリストにアクセスできます

#### パスワードの変更

- 拡張アイコンを右クリックして「パスワードを設定（変更）する」を選択すると、パスワードの設定や変更ができます
- 既にパスワードが設定されている場合は、現在のパスワードを入力してから新しいパスワードを設定する必要があります
- パスワード変更時は、認証が必要な場合があります

#### パスワードを忘れた場合のデータリセット

- パスワード入力画面の「パスワードを忘れた場合」リンクをクリックすると、データリセット機能が利用できます
- データリセットを実行すると、**すべてのデータ（ブックマーク、パスワード設定）が削除されます**
- この操作は取り消せません
- リセット前に2回の確認ダイアログが表示され、データが失われる旨が明記されます
- CSVバックアップがある場合は、リセット後にCSVインポート機能で復元できます
- リセット後は、初回起動時のパスワード設定画面が表示されます

#### パスワードのセキュリティ

- パスワードはハッシュ化されて保存されるため、ストレージから直接パスワードを読み取ることはできません
- パスワード設定は`chrome.storage.sync`に保存されるため、同じGoogleアカウントでログインしているすべてのデバイスで同期されます
- パスワードを忘れた場合の救済措置として、データリセット機能が用意されています

## ファイル構成

- `manifest.json` - 拡張機能の設定ファイル
- `popup.html/js/css` - アイコンクリック時のポップアップ
- `list.html/js/css` - ブックマークリスト表示ページ
- `background.js` - バックグラウンドスクリプト（Service Worker）
- `icons/` - 拡張機能のアイコンファイル（16x16, 48x48, 128x128）
- `generate-icons.html` - アイコン生成ツール（HTML版）
- `generate-icons.py` - アイコン生成ツール（Python版）